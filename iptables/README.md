плейбук для работы с iptables

1. при помощи шаблона ipt_dev.j2 и переменных, которые определены в /defaults/main.yml и group_vars генерируем правила iptables
2. создаём директорию /data/iptables и файл  /data/iptables/ipt_prod.sh
3. кидаем шаблон на сервер в виде файла ipt_dev.sh
4. запускаем ipt_dev.sh с целью применения сгенерированных правил
5. проверяем доступность 22 порта

Важно:
при прокатке плейбука через ansible-playbook -i environments/all/inventory.yml playbooks/iptables.yml -D последние 2 задания не будут выполнены. Это сделано с целью не разъебать всё и вся.

После того как мы убедились в работоспособности сгенерированных правил, запускаем плейбук с ключом -e iptables_prod=yes

6. копируем ipt_dev.sh в ipt_prod.sh
7. создаём крону, которая после перезагрузки сервера запускает скрипт ipt_prod.sh и применяет наши правила + записывает логи в /var/log/iptables.log